<!doctype html>
<html lang=ru>
    <head>
        <link href="/img/favicon.ico" rel="icon" type="image/x-icon" />

        <script type="text/javascript" src="/js/jquery-1.10.2.min.js"></script>
        <script type="text/javascript" src="/js/main.js"></script>
        <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
        <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>        

        <script src="/js/codemirror/lib/codemirror.js"></script>
        <script src="/js/codemirror/addon/edit/matchbrackets.js"></script>
        <script src="/js/codemirror/mode/php/php.js"></script>
        <script src="/js/codemirror/mode/htmlmixed/htmlmixed.js"></script>
        <script src="/js/codemirror/mode/xml/xml.js"></script>
        <script src="/js/codemirror/mode/javascript/javascript.js"></script>
        <script src="/js/codemirror/mode/css/css.js"></script>
        <script src="/js/codemirror/mode/clike/clike.js"></script>

        <link rel="stylesheet" href="/js/codemirror/lib/codemirror.css">
        <link rel="stylesheet" href="/js/codemirror/theme/ambiance.css">
        <link rel="stylesheet" href="/js/codemirror/theme/xq-light.css">
        <link rel="stylesheet" href="/js/codemirror/theme/neat.css">

        <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
        <link rel="stylesheet" href="/css/main.css" type="text/css">

        <meta charset=utf-8>
        <title>PHP console</title>
    </head>
    <body>
        <div id="main">
            <form name="{{ collectionForm.vars.name }}" method="post" action="/script/execute">
                <div class="panel">
                    <input id="exec-btn" class="cnt-btn" type="button" value="Execute">
                    <input id="save-btn" class="cnt-btn" type="button" value="Save">
                </div>
                <div id="tab-h-hold" >
                {% spaceless %}    
                    <div class="wrap no-select">
                    {% for form in collectionForm.scripts %}
                        <div tabnum="{{ loop.index0 }}" class="tab-head {% if loop.first %} selected{% endif %}">
                            {{ form_widget(form.name) }}
                            <div class="tab-text" spellcheck="false">{{ form.name.vars.value|default('New script') }}</div>
                            <div class="close-tab-btn"></div>
                        </div>
                    {% endfor %}
                    </div>
                    <div class="tab-base"></div>
                {% endspaceless %}
                </div>
                <div class="editor">
                    <div class="cm-hold">
                    {% for form in collectionForm.scripts %}
                        <div tabnum = "{{ loop.index0 }}" class="tab-body{% if loop.first %} selected{% endif %}">
                        {{ form_widget(form.code, { attr: { class: 'code-editor' } } ) }}
                        {{ form_widget(form.key, { attr: { class: 'db-key' } }) }}
                        </div>
                    {% endfor %}       
                    </div>
                    <div class="hr-resize"></div>
                    <div class="saved">
                        <ul>
                        {% for script in scripts %}
                            <li class="el-name"><span title="Click to select" data-key="{{ script.key }}" class="sc-name">{{ script.name }}</span></li>
                        {% endfor %}
                        </ul>
                    </div>
                </div>
            </form>
            <div class="v-resize"></div>
            <div id="result" class="hidden">
                <div id="exec-params">
                    <span id="mem"></span>
                    &nbsp;<span style="color: #bbb;">&#124;</span>&nbsp;
                    <span id="time"></span>
                </div>
                <div id="output"></div>
            </div>   
        </div>
        <script type='text/javascript'>
            {% set prototype = collectionForm.scripts.vars.prototype %}
            var collectionFormName = "{{ collectionForm.scripts.vars.name }}";
            var collectionName = "{{ collectionForm.scripts.vars.name }}";
            var scriptIdx = {{ collectionForm.scripts|length }};
            
            var keyIdProto = "{% filter escape('js') %}{{ collectionForm.scripts.vars.prototype.key.vars.id }}{% endfilter %}";
            var codeIdProto = "{% filter escape('js') %}{{ collectionForm.scripts.vars.prototype.code.vars.id }}{% endfilter %}";
            var nameIdProto = "{% filter escape('js') %}{{ collectionForm.scripts.vars.prototype.name.vars.id }}{% endfilter %}";
            
            var tabHeadProto = "{% filter escape('js') %}{% include 'Proto/tabHead.html.twig' with { prototype: prototype } %}{% endfilter %}";
            var tabBodyProto = "{% filter escape('js') %}{% include 'Proto/tabBody.html.twig' with { prototype: prototype } %}{% endfilter %}";
        </script>
    </body>
</html>	
